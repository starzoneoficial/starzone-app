name: Build Electron

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  build:
    runs-on: ${{ matrix.os }}
    
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        # Quitar cache si no hay lock file
        # cache: 'npm'
    
    - name: Install dependencies
      run: |
        # Listar archivos primero para debug
        echo "=== Archivos en repositorio ==="
        ls -la
        
        # Instalar dependencias (sin lock file)
        echo "Installing dependencies..."
        npm install --no-audit --no-fund --prefer-offline
        
        # Mostrar qué se instaló
        echo "=== Dependencies installed ==="
        npm list --depth=0 2>/dev/null || true
    
    - name: Build Electron
      run: |
        echo "Building for ${{ runner.os }}..."
        
        case "${{ runner.os }}" in
          "Linux")
            # Build para Linux
            npm run build:linux --if-present || \
            npm run build --if-present || \
            npx electron-builder --linux
            ;;
          "Windows")
            # Build para Windows
            npm run build:win --if-present || \
            npm run build:windows --if-present || \
            npm run build --if-present || \
            npx electron-builder --win
            ;;
          "macOS")
            # Build para macOS
            npm run build:mac --if-present || \
            npm run build:macos --if-present || \
            npm run build --if-present || \
            npx electron-builder --mac
            ;;
        esac
      
      env:
        CI: true
        ELECTRON_SKIP_NOTARIZE: true
    
    - name: Upload artifacts
      if: success()
      uses: actions/upload-artifact@v4
      with:
        name: electron-${{ runner.os }}
        path: |
          dist/
          release/
          out/
          *.exe
          *.dmg
          *.AppImage
        if-no-files-found: warn
